<UserControl x:Class="NetSentinel.UI.AlertsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource DeepNavyBlueBrush}">
    
    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,30">
            <TextBlock Text="Security Alerts" Style="{StaticResource TitleText}" Margin="0,0,0,10"/>
            <TextBlock Text="Monitor and review security alerts and warnings" Style="{StaticResource SubtitleText}"/>
        </StackPanel>

        <!-- Stats -->
        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Style="{StaticResource Card}" Grid.Column="0" Margin="0,0,10,0">
                <StackPanel>
                    <TextBlock Text="Total Alerts" Style="{StaticResource StatLabel}"/>
                    <TextBlock Text="{Binding TotalAlerts}" Style="{StaticResource StatValue}" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Grid.Column="1" Margin="10,0,10,0" Background="#7F1D1D">
                <StackPanel>
                    <TextBlock Text="Critical" Style="{StaticResource StatLabel}"/>
                    <TextBlock Text="{Binding CriticalAlerts}" Style="{StaticResource StatValue}" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Grid.Column="2" Margin="10,0,10,0" Background="#78350F">
                <StackPanel>
                    <TextBlock Text="Warnings" Style="{StaticResource StatLabel}"/>
                    <TextBlock Text="{Binding WarningAlerts}" Style="{StaticResource StatValue}" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Grid.Column="3" Margin="10,0,0,0" Background="#1E3A8A">
                <StackPanel>
                    <TextBlock Text="Info" Style="{StaticResource StatLabel}"/>
                    <TextBlock Text="{Binding InfoAlerts}" Style="{StaticResource StatValue}" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Filters -->
        <Border Style="{StaticResource Card}" Grid.Row="2" Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" 
                        Style="{StaticResource ModernTextBox}" Margin="0,0,15,0"/>

                <ComboBox Grid.Column="1" ItemsSource="{Binding SeverityFilters}" 
                         SelectedItem="{Binding SelectedSeverity}"
                         Style="{StaticResource ModernComboBox}" Margin="0,0,15,0"/>

                <CheckBox Grid.Column="2" Content="Unread Only" IsChecked="{Binding ShowOnlyUnread}"
                         Style="{StaticResource ModernCheckBox}" VerticalAlignment="Center" Margin="0,0,15,0"/>

                <Button Grid.Column="3" Content="Mark All Read" Style="{StaticResource ModernButton}" 
                       Command="{Binding MarkAllAsReadCommand}" Margin="0,0,10,0"/>

                <Button Grid.Column="4" Content="Export CSV" Style="{StaticResource ModernButton}" 
                       Command="{Binding ExportAlertsCommand}"/>
            </Grid>
        </Border>

        <!-- Alerts List -->
        <Border Style="{StaticResource Card}" Grid.Row="3">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Alerts}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{StaticResource DarkBgBrush}" CornerRadius="8" 
                                   Padding="20" Margin="0,0,0,15" Cursor="Hand">
                                <Border.InputBindings>
                                    <MouseBinding MouseAction="LeftClick" 
                                                 Command="{Binding DataContext.MarkAsReadCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                 CommandParameter="{Binding}"/>
                                </Border.InputBindings>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Severity Badge -->
                                    <Border Grid.Column="0" CornerRadius="8" Padding="12,6" Margin="0,0,20,0" 
                                           VerticalAlignment="Top">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                        <Setter Property="Background" Value="#DC2626"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Warning">
                                                        <Setter Property="Background" Value="#F59E0B"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Severity}" Value="Info">
                                                        <Setter Property="Background" Value="#3B82F6"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding Severity}" FontSize="12" FontWeight="Bold" 
                                                  Foreground="White"/>
                                    </Border>

                                    <!-- Content -->
                                    <StackPanel Grid.Column="1">
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="SemiBold" 
                                                      Foreground="{StaticResource LightTextBrush}" Margin="0,0,8,0"/>
                                            <TextBlock Text="[NEW]" FontSize="11" Foreground="#F59E0B" FontWeight="Bold"
                                                      VerticalAlignment="Center"
                                                      Visibility="{Binding IsRead, Converter={StaticResource InverseBoolToVisConverter}}"/>
                                        </StackPanel>
                                        
                                        <TextBlock Text="{Binding Description}" FontSize="13" 
                                                  Foreground="{StaticResource MutedTextBrush}" 
                                                  TextWrapping="Wrap" Margin="0,0,0,12"/>
                                        
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Timestamp, StringFormat='Time: {0:yyyy-MM-dd HH:mm:ss}'}" 
                                                      FontSize="12" Foreground="{StaticResource MutedTextBrush}"/>
                                            <TextBlock Text="{Binding SourceIp, StringFormat=' | Source IP: {0}'}" 
                                                      FontSize="12" Foreground="{StaticResource MutedTextBrush}"
                                                      Visibility="{Binding SourceIp, Converter={StaticResource NullToVisibilityConverter}}"/>
                                            <TextBlock Text="{Binding SourceMac, StringFormat=' | MAC: {0}'}" 
                                                      FontSize="12" Foreground="{StaticResource MutedTextBrush}"
                                                      Visibility="{Binding SourceMac, Converter={StaticResource NullToVisibilityConverter}}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Unread Indicator -->
                                    <Ellipse Grid.Column="2" Width="12" Height="12" Fill="{StaticResource ElectricBlueBrush}" 
                                            VerticalAlignment="Top" Margin="15,0,0,0"
                                            Visibility="{Binding IsRead, Converter={StaticResource InverseBoolToVisConverter}}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
